<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event category="CREATE" id="0">
  <actions>
    <action id="603" library="1">
      <!--action name: Code-->
      <kind>CODE</kind>
      <allowRelative>false</allowRelative>
      <question>false</question>
      <canApplyTo>true</canApplyTo>
      <actionType>CODE</actionType>
      <functionName/>
      <relative>false</relative>
      <not>false</not>
      <appliesTo>.self</appliesTo>
      <arguments>
        <argument kind="STRING">{
    global.levelchoice = 1
    menu_create(40, 300, 200, 200, 32);
    
    menu_background(208, 24, 8, 12, 4);
    
    menu_addlink("Host Game", 'event_user(0);');
    menu_addlink("Join (lobby)", '
        room_goto_fix(Lobby);
    ');
    menu_addlink("Join (manual)", '
        global.isHost = false;
        global.serverIP = get_string("Please enter the IP address or hostname of the server you want to join", "127.0.0.1");
        global.serverPort = get_integer("Please enter the port of the server you want to join", 8190);
        instance_create(0,0,Client);
        Client.returnRoom = Menu;
    ');
    menu_addlink("Options", '
        room_goto_fix(Options);
    ');
    menu_addlink("Credits", '
        room_goto_fix(Credits);
    ');
    menu_addback("Quit", '
        game_end();
    ');

    // Music setting set to "Menu Only" or "Menu and In-Game"
    if (!sound_isplaying(global.MenuMusic)
        &amp;&amp; (global.music == MUSIC_MENU_ONLY || global.music == MUSIC_BOTH))
    {
        AudioControlPlaySong(global.MenuMusic);
    }

    fade = 0;
    
    // ini says we have a downloaded background
    if (global.backgroundHash != "default")
    {
        var validBackground;
        validBackground = false;

        // background exists
        if (file_exists("background.png"))
        {
            // passes integrity check
            if (global.backgroundHash == GG2DLL_compute_MD5("background.png"))
            {
                // use downloaded background
                menuimage = background_add("background.png", false, false);
                validBackground = true;
            }
        }
        // otherwise, reset values
        if (!validBackground)
        {
            global.backgroundHash = "default";
            global.backgroundTitle = "";
            global.backgroundURL = "";
            global.backgroundShowVersion = true;
            ini_open("gg2.ini");
            ini_write_string("Background", "BackgroundHash", global.backgroundHash);
            ini_write_string("Background", "BackgroundTitle", global.backgroundTitle);
            ini_write_string("Background", "BackgroundURL", global.backgroundURL);
            ini_write_real("Background", "BackgroundShowVersion", global.backgroundShowVersion);
            ini_close();
        }
    }

    // use default background if ini says we should
    if (global.backgroundHash == "default")
    {
        menuimage = choose(MenuBackground1, MenuBackground2);
    }

    if(global.dedicatedMode == 1)
        event_user(0);
}
</argument>
      </arguments>
    </action>
  </actions>
</event>
